<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

    <title>StreamFlex</title>
    
    <!-- Enhanced Ad-Blocking and Anti-Popup Script -->
    <script>
      (function() {
        'use strict';
        
        // Ultra-aggressive popup blocking - complete override
        let popupBlockCount = 0;
        
        // COMPLETE window.open blocking
        window.open = function() {
          popupBlockCount++;
          console.log(`ðŸš« Popup #${popupBlockCount} BLOCKED`);
          return null;
        };
        
        // Block ALL popup methods
        window.showModalDialog = function() { 
          console.log('ðŸš« Modal dialog BLOCKED'); 
          return null; 
        };
        
        // Override alert, confirm, prompt to prevent popup-related interactions
        window.alert = function(msg) { 
          console.log('ðŸš« Alert BLOCKED:', msg); 
        };
        window.confirm = function(msg) { 
          console.log('ðŸš« Confirm BLOCKED:', msg); 
          return false; 
        };
        window.prompt = function(msg) { 
          console.log('ðŸš« Prompt BLOCKED:', msg); 
          return null; 
        };
        
        // Lock window.open completely
        Object.defineProperty(window, 'open', {
          value: function() {
            console.log('ðŸ”’ Window.open LOCKED');
            return null;
          },
          writable: false,
          configurable: false
        });
        
        // Block document.open (another popup method)
        const originalDocOpen = document.open;
        document.open = function() {
          console.log('ðŸš« Document.open BLOCKED');
          return null;
        };
        
        // Block focus/blur popup triggers completely
        window.focus = function() {
          console.log('ðŸš« Window.focus BLOCKED');
          return false;
        };
        
        window.blur = function() {
          console.log('ðŸš« Window.blur BLOCKED');
          return false;
        };
        
        // Block location changes that could trigger popups
        const originalAssign = window.location.assign;
        const originalReplace = window.location.replace;
        
        window.location.assign = function(url) {
          console.log('ðŸš« Location.assign BLOCKED:', url);
        };
        
        window.location.replace = function(url) {
          console.log('ðŸš« Location.replace BLOCKED:', url);
        };
        
        // Block iframe-based popup attempts
        if (!window.originalCreateElement) {
          window.originalCreateElement = document.createElement.bind(document);
          document.createElement = function(tagName) {
            const element = window.originalCreateElement(tagName);
            
            if (tagName.toLowerCase() === 'iframe') {
              const originalSetSrc = Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype, 'src').set;
              Object.defineProperty(element, 'src', {
                set: function(value) {
                  // Block suspicious iframe sources that could be popups
                  if (value && (
                    value.includes('popup') || 
                    value.includes('redirect') ||
                    value.includes('ads') ||
                    (value.includes('http') && !value.includes('vidsrc') && !value.includes(window.location.hostname))
                  )) {
                    console.log('Suspicious iframe src blocked:', value);
                    return;
                  }
                  originalSetSrc.call(this, value);
                },
                get: function() {
                  return this.getAttribute('src');
                }
              });
            }
            
            return element;
          };
        }
        
        // Block pushState navigation that opens ads
        const originalPushState = history.pushState;
        history.pushState = function(state, title, url) {
          if (url && (url.includes('ads') || url.includes('popup') || url.includes('promo'))) {
            console.log('Ad navigation blocked:', url);
            return;
          }
          return originalPushState.call(this, state, title, url);
        };

        // Block all dialog types
        window.alert = function(message) {
          console.log('Alert blocked:', message);
          return undefined;
        };
        
        window.confirm = function(message) {
          console.log('Confirm blocked:', message);
          return false;
        };
        
        window.prompt = function(message, defaultText) {
          console.log('Prompt blocked:', message);
          return null;
        };

        // Enhanced navigation blocking
        const originalAssign = window.location.assign;
        const originalReplace = window.location.replace;
        const originalReload = window.location.reload;
        
        window.location.assign = function(url) {
          if (url && (url.includes('ads') || url.includes('popup') || url.includes('redirect'))) {
            console.log('Location.assign blocked to:', url);
            return false;
          }
          return originalAssign.call(this, url);
        };
        
        window.location.replace = function(url) {
          if (url && (url.includes('ads') || url.includes('popup') || url.includes('redirect'))) {
            console.log('Location.replace blocked to:', url);
            return false;
          }
          return originalReplace.call(this, url);
        };

        // Block common ad-related globals
        window.gtag = function() { console.log('Google Analytics blocked'); };
        window.dataLayer = window.dataLayer || [];
        window._gaq = window._gaq || [];
        
        // Block focus stealing
        const originalFocus = window.focus;
        window.focus = function() {
          console.log('Window focus steal blocked');
          return false;
        };

        // Simplified ad element blocking focused on VidSrc
        function blockAds() {
          const adSelectors = [
            // Focus on popup/overlay patterns that affect VidSrc
            '[class*="popup"]:not(.video-player)', '[id*="popup"]:not(.video-player)',
            '[class*="overlay"]:not(.video-player)', '[id*="overlay"]:not(.video-player)',
            '[class*="interstitial"]', '[id*="interstitial"]',
            '.advertisement', '.ad-container', '.popup-overlay', '.modal-backdrop',
            
            // Specific ad networks (but not our video iframe)
            'iframe[src*="ads"]:not(#video-player-iframe)', 
            'iframe[src*="doubleclick"]:not(#video-player-iframe)',
            'iframe[src*="googlesyndication"]:not(#video-player-iframe)',
            
            // Elements with click handlers that open popups
            '[onclick*="window.open"]', '[onclick*="popup"]'
          ];
          
          adSelectors.forEach(selector => {
            try {
              const elements = document.querySelectorAll(selector);
              elements.forEach(el => {
                // Double check we're not targeting our video player
                if (el.id === 'video-player-iframe' || el.classList.contains('video-player')) {
                  return;
                }
                
                // Remove the element
                if (el.parentNode) {
                  el.style.display = 'none';
                  el.remove();
                }
              });
            } catch (e) {
              // Ignore selector errors
            }
          });
        }

        // Block event propagation for ad clicks
        document.addEventListener('click', function(e) {
          const target = e.target;
          if (target && (
            target.tagName === 'A' && target.href && (
              target.href.includes('ads') || 
              target.href.includes('popup') ||
              target.href.includes('redirect')
            )
          )) {
            console.log('Ad click blocked:', target.href);
            e.preventDefault();
            e.stopPropagation();
            return false;
          }
        }, true);

        // Run ad blocking with reasonable frequency
        blockAds();
        setInterval(blockAds, 2000); // Check every 2 seconds
        
        // DOM observer for dynamic content
        if (window.MutationObserver) {
          const observer = new MutationObserver(function(mutations) {
            let shouldBlock = false;
            mutations.forEach(function(mutation) {
              if (mutation.addedNodes.length > 0) {
                shouldBlock = true;
              }
            });
            if (shouldBlock) {
              setTimeout(blockAds, 100); // Small delay to let content settle
            }
          });
          
          const observerConfig = {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['style', 'class', 'id', 'src']
          };
          
          // Start observing when DOM is ready
          if (document.body) {
            observer.observe(document.body, observerConfig);
          } else {
            document.addEventListener('DOMContentLoaded', function() {
              observer.observe(document.body, observerConfig);
            });
          }
        }

        // Block common iframe injection techniques
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
          const element = originalCreateElement.call(this, tagName);
          if (tagName.toLowerCase() === 'iframe') {
            // Monitor iframe src changes
            Object.defineProperty(element, 'src', {
              set: function(url) {
                if (url && (url.includes('ads') || url.includes('popup') || url.includes('redirect'))) {
                  console.log('Blocked iframe creation with ad URL:', url);
                  return;
                }
                this.setAttribute('src', url);
              },
              get: function() {
                return this.getAttribute('src');
              }
            });
          }
          return element;
        };

        console.log('Enhanced ad blocking initialized');
        // Enhanced click blocking for popup ads while preserving video functionality
        let clickTimeout;
        document.addEventListener('click', function(e) {
          const target = e.target;
          
          // Allow clicks on our video player iframe and its container
          if (target && (
            target.id === 'video-player-iframe' ||
            target.closest('#video-player-iframe') ||
            target.closest('.video-player-container') ||
            target.closest('[class*="video-player"]')
          )) {
            return; // Allow video player clicks
          }
          
          // Block suspicious ad clicks
          if (target && (
            target.classList.toString().includes('ad') ||
            target.id.includes('ad') ||
            target.getAttribute('data-ad') ||
            target.closest('[class*="ad"]') ||
            target.closest('[id*="ad"]') ||
            target.getAttribute('onclick') ||
            target.closest('[onclick]')
          )) {
            console.log('Ad click blocked');
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return false;
          }
          
          // Detect rapid multiple clicks (often ad behavior)
          clearTimeout(clickTimeout);
          clickTimeout = setTimeout(() => {
            // Reset click detection
          }, 100);
          
          // Block ALL middle clicks and ctrl+clicks (common popup triggers)
          if (e.ctrlKey || e.metaKey || e.button === 1 || e.button === 2) {
            console.log('Middle/Ctrl click blocked (potential popup trigger)');
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return false;
          }
          
          // AGGRESSIVE click blocking for ads/popups
          const targetElement = e.target;
          if (targetElement) {
            // Block ANY external link clicks
            const clickedLink = targetElement.closest && targetElement.closest('a');
            if (clickedLink && clickedLink.href) {
              const href = clickedLink.href;
              // Allow only same-origin links and our video player
              if (!href.startsWith(window.location.origin) && !targetElement.closest('.video-player-container')) {
                console.log('ðŸš« External link BLOCKED:', href);
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                return false;
              }
            }
            
            // Block clicks on suspicious elements
            const tagName = targetElement.tagName?.toLowerCase();
            if (tagName === 'iframe' && !targetElement.closest('.video-player-container')) {
              console.log('ðŸš« Iframe click BLOCKED');
              e.preventDefault();
              e.stopPropagation();
              return false;
            }
          }
          
          // Block clicks on elements with suspicious attributes
          if (target && (
            target.getAttribute('target') === '_blank' ||
            target.closest('[target="_blank"]') ||
            target.getAttribute('href')?.includes('javascript:') ||
            target.closest('[href*="javascript:"]')
          )) {
            console.log('Suspicious link click blocked');
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return false;
          }
        }, true);
        
        // Block context menu on ads and iframes
        document.addEventListener('contextmenu', function(e) {
          const target = e.target;
          if (target && (
            target.classList.toString().includes('ad') ||
            target.tagName === 'IFRAME'
          )) {
            console.log('Context menu blocked on ad/iframe');
            e.preventDefault();
            return false;
          }
        }, true);
        
        // Block mousedown events that could trigger popups
        document.addEventListener('mousedown', function(e) {
          // Block any mousedown that isn't on our video player
          if (e.target && !e.target.closest('#video-player-iframe') && !e.target.closest('.video-player-container')) {
            if (e.button !== 0) { // Not left click
              console.log('Non-left click blocked');
              e.preventDefault();
              e.stopPropagation();
              return false;
            }
          }
        }, true);
        
        // NUCLEAR OPTION: DOM monitoring and removal
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            mutation.addedNodes.forEach((node) => {
              if (node.nodeType === 1) { // Element node
                const element = node;
                
                // DESTROY any non-video iframes immediately
                if (element.tagName === 'IFRAME') {
                  const src = element.getAttribute('src') || '';
                  if (!src.includes('vidsrc') && !src.includes('youtube') && !element.closest('.video-player-container')) {
                    console.log('ðŸ”¥ DESTROYING suspicious iframe:', src);
                    element.remove();
                    return;
                  }
                }
                
                // DESTROY popup-related elements
                const suspiciousSelectors = [
                  'a[target="_blank"]',
                  'a[href*="javascript:"]',
                  '[onclick*="window.open"]',
                  '[onclick*="popup"]',
                  '.popup', '.ad', '.advertisement', 
                  '[class*="ad-"]', '[id*="ad-"]',
                  '[class*="popup"]', '[id*="popup"]'
                ];
                
                suspiciousSelectors.forEach(selector => {
                  try {
                    const suspiciousElements = element.querySelectorAll ? element.querySelectorAll(selector) : [];
                    suspiciousElements.forEach(el => {
                      console.log('ðŸ”¥ DESTROYING suspicious element:', selector);
                      el.remove();
                    });
                    
                    // Check if the element itself matches
                    if (element.matches && element.matches(selector)) {
                      console.log('ðŸ”¥ DESTROYING suspicious element (self):', selector);
                      element.remove();
                    }
                  } catch (e) {
                    // Ignore selector errors
                  }
                });
              }
            });
          });
        });
        
        // Start aggressive monitoring
        observer.observe(document.documentElement, {
          childList: true,
          subtree: true,
          attributes: true,
          attributeFilter: ['href', 'onclick', 'target', 'src']
        });
      })();
    </script>
    

  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>