<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

    <title>StreamFlex</title>
    
    <!-- NUCLEAR-LEVEL Ad-Blocking and Anti-Popup Script -->
    <script>
      (function() {
        'use strict';
        
        console.log('ðŸš« NUCLEAR POPUP BLOCKING ACTIVATED');
        
        // === PHASE 1: COMPLETE WINDOW CONTROL ===
        let popupBlockCount = 0;
        
        // Lock window.open permanently
        Object.defineProperty(window, 'open', {
          value: function() {
            popupBlockCount++;
            console.log(`ðŸš« Popup #${popupBlockCount} NUKED`);
            return null;
          },
          writable: false,
          configurable: false
        });
        
        // Block ALL dialog methods
        window.alert = () => console.log('ðŸš« Alert NUKED');
        window.confirm = () => (console.log('ðŸš« Confirm NUKED'), false);
        window.prompt = () => (console.log('ðŸš« Prompt NUKED'), null);
        window.showModalDialog = () => (console.log('ðŸš« Modal NUKED'), null);
        
        // Block focus/blur manipulation
        window.focus = () => (console.log('ðŸš« Focus steal BLOCKED'), false);
        window.blur = () => (console.log('ðŸš« Blur BLOCKED'), false);
        
        // === PHASE 2: NAVIGATION HIJACKING PREVENTION ===
        let originalAssign, originalReplace;
        try {
          originalAssign = window.location.assign.bind(window.location);
          originalReplace = window.location.replace.bind(window.location);
        } catch (e) {
          // Fallback for read-only assign/replace
          originalAssign = function(url) { window.location.href = url; };
          originalReplace = function(url) { window.location.href = url; };
        }
        
        const originalPushState = history.pushState.bind(history);
        const originalReplaceState = history.replaceState.bind(history);
        
        try {
          window.location.assign = function(url) {
            if (url && (url.includes('ads') || url.includes('popup') || url.includes('redirect') || url.includes('promo'))) {
              console.log('ðŸš« Location.assign NUKED:', url);
              return;
            }
            return originalAssign(url);
          };
        } catch (e) {
          console.log('ðŸš« Location.assign override blocked (read-only)');
        }
        
        try {
          window.location.replace = function(url) {
            if (url && (url.includes('ads') || url.includes('popup') || url.includes('redirect') || url.includes('promo'))) {
              console.log('ðŸš« Location.replace NUKED:', url);
              return;
            }
            return originalReplace(url);
          };
        } catch (e) {
          console.log('ðŸš« Location.replace override blocked (read-only)');
        }
        
        history.pushState = function(state, title, url) {
          if (url && (url.includes('ads') || url.includes('popup') || url.includes('promo'))) {
            console.log('ðŸš« PushState NUKED:', url);
            return;
          }
          return originalPushState(state, title, url);
        };
        
        history.replaceState = function(state, title, url) {
          if (url && (url.includes('ads') || url.includes('popup') || url.includes('promo'))) {
            console.log('ðŸš« ReplaceState NUKED:', url);
            return;
          }
          return originalReplaceState(state, title, url);
        };
        
        // === PHASE 3: IFRAME SECURITY ===
        const originalCreateElement = document.createElement.bind(document);
        document.createElement = function(tagName) {
          const element = originalCreateElement(tagName);
          
          if (tagName.toLowerCase() === 'iframe') {
            // Monitor iframe src for suspicious content
            Object.defineProperty(element, 'src', {
              set: function(value) {
                if (value && (
                  value.includes('ads') || 
                  value.includes('popup') || 
                  value.includes('redirect') ||
                  (value.includes('http') && !value.includes('vidsrc') && !value.includes(window.location.hostname))
                )) {
                  console.log('ðŸš« Suspicious iframe NUKED:', value);
                  return;
                }
                this.setAttribute('src', value);
              },
              get: function() {
                return this.getAttribute('src');
              }
            });
          }
          
          return element;
        };
        
        // === PHASE 4: TARGETED VIDSRC CLICK PROTECTION ===
        document.addEventListener('click', function(e) {
          const target = e.target;
          
          // ONLY protect clicks within VidSrc iframes and suspicious ad elements
          const isVidSrcIframe = target && (
            target.closest('iframe[src*="vidsrc"]') ||
            target.tagName === 'IFRAME' && target.src && target.src.includes('vidsrc')
          );
          
          const isSuspiciousElement = target && (
            target.closest('[onclick*="window.open"]') ||
            target.closest('[onclick*="popup"]') ||
            target.getAttribute('onclick')?.includes('window.open') ||
            target.getAttribute('onclick')?.includes('popup')
          );
          
          // Only block if it's a VidSrc iframe interaction OR suspicious popup element
          if (isVidSrcIframe || isSuspiciousElement) {
            // For VidSrc iframes, block external redirects
            const link = target.closest('a');
            if (link && link.href && !link.href.startsWith(window.location.origin)) {
              console.log('ðŸš« VidSrc external link BLOCKED:', link.href);
              e.preventDefault();
              e.stopImmediatePropagation();
              return false;
            }
            
            // Block popup-related attributes within VidSrc
            if (target.getAttribute('onclick') || 
                target.getAttribute('target') === '_blank' ||
                target.closest('[onclick]') ||
                target.closest('[target="_blank"]')) {
              console.log('ðŸš« VidSrc popup click BLOCKED');
              e.preventDefault();
              e.stopImmediatePropagation();
              return false;
            }
            
            // Block suspicious click combinations within VidSrc
            if (e.button !== 0 || e.ctrlKey || e.metaKey) {
              console.log('ðŸš« VidSrc suspicious click BLOCKED');
              e.preventDefault();
              e.stopImmediatePropagation();
              return false;
            }
          }
        }, true);
        
        // === PHASE 5: TARGETED AD DESTRUCTION ===
        function nukeVidSrcAds() {
          const vidsrcSpecificSelectors = [
            // VidSrc specific ad patterns
            'iframe[src*="vidsrc"] + div[class*="popup"]',
            'iframe[src*="vidsrc"] + div[class*="overlay"]',
            'iframe[src*="vidsrc"] + div[id*="popup"]',
            
            // Suspicious iframes that aren't our video player
            'iframe[src*="ads"]:not(#video-player-iframe)',
            'iframe[src*="doubleclick"]:not(#video-player-iframe)', 
            'iframe[src*="googlesyndication"]:not(#video-player-iframe)',
            
            // Popup elements with suspicious click handlers
            '[onclick*="window.open"]',
            '[onclick*="popup"]'
          ];
          
          let nukedCount = 0;
          vidsrcSpecificSelectors.forEach(selector => {
            try {
              const elements = document.querySelectorAll(selector);
              elements.forEach(el => {
                // Only remove if it's clearly not part of our main app
                if (el.id !== 'video-player-iframe' && 
                    !el.closest('.video-player-container') &&
                    !el.closest('#root') || 
                    el.closest('iframe[src*="vidsrc"]')) {
                  el.remove();
                  nukedCount++;
                }
              });
            } catch (e) {
              // Ignore selector errors
            }
          });
          
          if (nukedCount > 0) {
            console.log(`ðŸš« Removed ${nukedCount} VidSrc ad elements`);
          }
        }
        
        // === PHASE 6: CONTINUOUS MONITORING ===
        // Initial VidSrc ad cleanup
        setTimeout(nukeVidSrcAds, 100);
        setInterval(nukeVidSrcAds, 2000); // Check every 2 seconds
        
        // Real-time DOM monitoring
        if (window.MutationObserver) {
          const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
              mutation.addedNodes.forEach(function(node) {
                if (node.nodeType === 1) { // Element node
                  const element = node;
                  
                  // Immediately destroy suspicious iframes
                  if (element.tagName === 'IFRAME') {
                    const src = element.getAttribute('src') || '';
                    if (!src.includes('vidsrc') && 
                        !src.includes('youtube') && 
                        !element.closest('.video-player-container') &&
                        element.id !== 'video-player-iframe') {
                      console.log('ðŸ”¥ INSTANT IFRAME DESTRUCTION:', src);
                      element.remove();
                      return;
                    }
                  }
                  
                  // Check for popup-related patterns
                  if (element.matches && (
                    element.matches('[class*="popup"]') ||
                    element.matches('[id*="popup"]') ||
                    element.matches('[class*="ad"]') ||
                    element.matches('[onclick*="window.open"]') ||
                    element.matches('a[target="_blank"]')
                  )) {
                    if (!element.closest('.video-player-container')) {
                      console.log('ðŸ”¥ INSTANT ELEMENT DESTRUCTION');
                      element.remove();
                    }
                  }
                }
              });
            });
          });
          
          // Start aggressive monitoring
          observer.observe(document.documentElement, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['href', 'onclick', 'target', 'src', 'class', 'id']
          });
        }
        
        // === PHASE 7: ANTI-CIRCUMVENTION ===
        // Block common ad globals
        window.gtag = () => console.log('ðŸš« Google Analytics NUKED');
        window.dataLayer = [];
        window._gaq = [];
        
        // Block context menus on suspicious elements
        document.addEventListener('contextmenu', function(e) {
          if (e.target && e.target.tagName === 'IFRAME' && e.target.id !== 'video-player-iframe') {
            console.log('ðŸš« Iframe context menu BLOCKED');
            e.preventDefault();
          }
        }, true);
        
        console.log('ðŸš« NUCLEAR AD BLOCKING: ALL SYSTEMS ARMED AND READY');
        
      })();
    </script>
    

  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>