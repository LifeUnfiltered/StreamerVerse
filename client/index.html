<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

    <title>StreamFlex</title>
    
    <!-- Enhanced Ad-Blocking and Anti-Popup Script -->
    <script>
      (function() {
        'use strict';
        
        // Aggressive popup and ad blocking
        const originalOpen = window.open;
        window.open = function(url, name, specs, replace) {
          console.log('Popup blocked:', url);
          return {
            focus: () => {},
            blur: () => {},
            close: () => {},
            closed: true,
            location: { href: 'about:blank' },
            document: { 
              write: () => {}, 
              close: () => {},
              open: () => {},
              writeln: () => {}
            },
            postMessage: () => {},
            addEventListener: () => {},
            removeEventListener: () => {}
          };
        };
        
        // Block pushState navigation that opens ads
        const originalPushState = history.pushState;
        history.pushState = function(state, title, url) {
          if (url && (url.includes('ads') || url.includes('popup') || url.includes('promo'))) {
            console.log('Ad navigation blocked:', url);
            return;
          }
          return originalPushState.call(this, state, title, url);
        };

        // Block all dialog types
        window.alert = function(message) {
          console.log('Alert blocked:', message);
          return undefined;
        };
        
        window.confirm = function(message) {
          console.log('Confirm blocked:', message);
          return false;
        };
        
        window.prompt = function(message, defaultText) {
          console.log('Prompt blocked:', message);
          return null;
        };

        // Enhanced navigation blocking
        const originalAssign = window.location.assign;
        const originalReplace = window.location.replace;
        const originalReload = window.location.reload;
        
        window.location.assign = function(url) {
          if (url && (url.includes('ads') || url.includes('popup') || url.includes('redirect'))) {
            console.log('Location.assign blocked to:', url);
            return false;
          }
          return originalAssign.call(this, url);
        };
        
        window.location.replace = function(url) {
          if (url && (url.includes('ads') || url.includes('popup') || url.includes('redirect'))) {
            console.log('Location.replace blocked to:', url);
            return false;
          }
          return originalReplace.call(this, url);
        };

        // Block common ad-related globals
        window.gtag = function() { console.log('Google Analytics blocked'); };
        window.dataLayer = window.dataLayer || [];
        window._gaq = window._gaq || [];
        
        // Block focus stealing
        const originalFocus = window.focus;
        window.focus = function() {
          console.log('Window focus steal blocked');
          return false;
        };

        // Simplified ad element blocking focused on VidSrc
        function blockAds() {
          const adSelectors = [
            // Focus on popup/overlay patterns that affect VidSrc
            '[class*="popup"]:not(.video-player)', '[id*="popup"]:not(.video-player)',
            '[class*="overlay"]:not(.video-player)', '[id*="overlay"]:not(.video-player)',
            '[class*="interstitial"]', '[id*="interstitial"]',
            '.advertisement', '.ad-container', '.popup-overlay', '.modal-backdrop',
            
            // Specific ad networks (but not our video iframe)
            'iframe[src*="ads"]:not(#video-player-iframe)', 
            'iframe[src*="doubleclick"]:not(#video-player-iframe)',
            'iframe[src*="googlesyndication"]:not(#video-player-iframe)',
            
            // Elements with click handlers that open popups
            '[onclick*="window.open"]', '[onclick*="popup"]'
          ];
          
          adSelectors.forEach(selector => {
            try {
              const elements = document.querySelectorAll(selector);
              elements.forEach(el => {
                // Double check we're not targeting our video player
                if (el.id === 'video-player-iframe' || el.classList.contains('video-player')) {
                  return;
                }
                
                // Remove the element
                if (el.parentNode) {
                  el.style.display = 'none';
                  el.remove();
                }
              });
            } catch (e) {
              // Ignore selector errors
            }
          });
        }

        // Block event propagation for ad clicks
        document.addEventListener('click', function(e) {
          const target = e.target;
          if (target && (
            target.tagName === 'A' && target.href && (
              target.href.includes('ads') || 
              target.href.includes('popup') ||
              target.href.includes('redirect')
            )
          )) {
            console.log('Ad click blocked:', target.href);
            e.preventDefault();
            e.stopPropagation();
            return false;
          }
        }, true);

        // Run ad blocking with reasonable frequency
        blockAds();
        setInterval(blockAds, 2000); // Check every 2 seconds
        
        // DOM observer for dynamic content
        if (window.MutationObserver) {
          const observer = new MutationObserver(function(mutations) {
            let shouldBlock = false;
            mutations.forEach(function(mutation) {
              if (mutation.addedNodes.length > 0) {
                shouldBlock = true;
              }
            });
            if (shouldBlock) {
              setTimeout(blockAds, 100); // Small delay to let content settle
            }
          });
          
          const observerConfig = {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['style', 'class', 'id', 'src']
          };
          
          // Start observing when DOM is ready
          if (document.body) {
            observer.observe(document.body, observerConfig);
          } else {
            document.addEventListener('DOMContentLoaded', function() {
              observer.observe(document.body, observerConfig);
            });
          }
        }

        // Block common iframe injection techniques
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
          const element = originalCreateElement.call(this, tagName);
          if (tagName.toLowerCase() === 'iframe') {
            // Monitor iframe src changes
            Object.defineProperty(element, 'src', {
              set: function(url) {
                if (url && (url.includes('ads') || url.includes('popup') || url.includes('redirect'))) {
                  console.log('Blocked iframe creation with ad URL:', url);
                  return;
                }
                this.setAttribute('src', url);
              },
              get: function() {
                return this.getAttribute('src');
              }
            });
          }
          return element;
        };

        console.log('Enhanced ad blocking initialized');
        // Enhanced click blocking for popup ads while preserving video functionality
        let clickTimeout;
        document.addEventListener('click', function(e) {
          const target = e.target;
          
          // Allow clicks on our video player iframe and its container
          if (target && (
            target.id === 'video-player-iframe' ||
            target.closest('#video-player-iframe') ||
            target.closest('.video-player-container') ||
            target.closest('[class*="video-player"]')
          )) {
            return; // Allow video player clicks
          }
          
          // Block suspicious ad clicks
          if (target && (
            target.classList.toString().includes('ad') ||
            target.id.includes('ad') ||
            target.getAttribute('data-ad') ||
            target.closest('[class*="ad"]') ||
            target.closest('[id*="ad"]') ||
            target.getAttribute('onclick') ||
            target.closest('[onclick]')
          )) {
            console.log('Ad click blocked');
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return false;
          }
          
          // Detect rapid multiple clicks (often ad behavior)
          clearTimeout(clickTimeout);
          clickTimeout = setTimeout(() => {
            // Reset click detection
          }, 100);
          
          // Block clicks that try to open new windows
          if (e.ctrlKey || e.metaKey || e.button === 1) {
            const href = target.getAttribute('href') || target.closest('a')?.getAttribute('href');
            if (href && !href.startsWith('#') && !href.includes('vidsrc') && !href.includes(window.location.hostname)) {
              console.log('External link click blocked');
              e.preventDefault();
              return false;
            }
          }
        }, true);
        
        // Block context menu on ads
        document.addEventListener('contextmenu', function(e) {
          const target = e.target;
          if (target && target.classList.toString().includes('ad')) {
            e.preventDefault();
            return false;
          }
        }, true);
      })();
    </script>
    

  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>